<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[PAGE_TITLE] - XJTLU iGEM Team 2025</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/fonts.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/glass-menu.css">
</head>
<body class="article-page [PAGE_CLASS]-page">
  <div id="menu-container"></div>
  
  <!-- Article Header -->
  <header class="article-header">
    <div class="container">
      <h1>[PAGE_TITLE]</h1>
      <p>[PAGE_DESCRIPTION]</p>
    </div>
  </header>

  <!-- Article Container -->
  <div class="article-container">
    <!-- Sidebar -->
    <div class="article-sidebar">
      <nav class="catalog">
        <h4 id="contents">Contents</h4>
        <ul class="catalog-list">
          <!-- Example structure with sub-sections -->
          <li><a href="#section-1">1. Section Title</a></li>
          <li><a href="#section-2">2. Section Title</a>
            <ul class="sub-catalog">
              <li><a href="#subsection-2-1" class="sub-heading">2.1 Subsection Title</a></li>
              <li><a href="#subsection-2-2" class="sub-heading">2.2 Subsection Title</a></li>
            </ul>
          </li>
          <li><a href="#section-3">3. Section Title</a></li>
          <!-- Add more sections as needed -->
        </ul>
      </nav>
    </div>
    
    <!-- Article Content -->
    <article class="article-content">
      <h2 id="section-1">1. Section Title</h2>
      <p>Content for the first section...</p>
      
      <h2 id="section-2">2. Section Title</h2>
      <p>Content for the second section...</p>
      
      <h3 id="subsection-2-1">2.1 Subsection Title</h3>
      <p>Content for subsection 2.1...</p>
      
      <h3 id="subsection-2-2">2.2 Subsection Title</h3>
      <p>Content for subsection 2.2...</p>
      
      <h2 id="section-3">3. Section Title</h2>
      <p>Content for the third section...</p>
      
      <!-- Special components examples -->
      
      <!-- GitHub Badge Example -->
      <!-- 
      <h3 id="project-repo">Project Repository <a href="https://github.com/username/repo"><img src="https://img.shields.io/badge/GitHub-RepoName-black?logo=github" alt="GitHub Repo" style="margin-left: 8px; vertical-align: middle;"></a></h3>
      -->
      
      <!-- Image Gallery Example -->
      <!--
      <div class="structure-gallery">
        <div class="structure-item">
          <img src="/assets/images/example1.png" alt="Example 1" class="structure-image">
          <p class="structure-id">Example 1</p>
        </div>
        <div class="structure-item">
          <img src="/assets/images/example2.png" alt="Example 2" class="structure-image">
          <p class="structure-id">Example 2</p>
        </div>
      </div>
      -->
    </article>
  </div>

  <!-- Utility Buttons -->
  <div class="article-utilities">
    <button class="utility-btn" id="scroll-to-top" title="Back to Top">
      â†‘
    </button>
  </div>

  <div id="footer"></div>
  <script src="/js/main.js"></script>
  <script>
    // Scroll to top functionality
    document.getElementById('scroll-to-top').addEventListener('click', function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Enhanced catalog functionality with sub-menu expansion
    document.addEventListener('DOMContentLoaded', function() {
      const catalogList = document.querySelector('.catalog-list');
      const headings = document.querySelectorAll('.article-content h2, .article-content h3, .article-content h4, .article-content h5');
      
      // Add smooth scrolling and active state
      const catalogLinks = document.querySelectorAll('.catalog-list a');
      catalogLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });
          }
        });
      });
      
      // Enhanced highlight active section with improved detection for subsections
      function updateActiveSection() {
        const scrollPos = window.scrollY + 100;
        let currentActiveSection = null;
        let currentMainSection = null;
        
        // Get all headings and sort by position
        const headingsArray = Array.from(headings);
        let candidates = [];
        
        // Find all possible active sections with improved logic for short paragraphs
        headings.forEach(function(heading, index) {
          const section = heading;
          const sectionTop = section.offsetTop;
          const id = section.getAttribute('id');
          
          if (!id) return; // Skip headings without IDs
          
          // Calculate section bottom based on next heading
          let sectionBottom;
          if (index < headingsArray.length - 1) {
            sectionBottom = headingsArray[index + 1].offsetTop;
          } else {
            sectionBottom = document.body.scrollHeight;
          }
          
          // For short sections, ensure minimum detection range
          const sectionHeight = sectionBottom - sectionTop;
          const minRange = 300; // Minimum detection range for short sections
          let effectiveBottom = sectionBottom;
          
          if (sectionHeight < minRange) {
            effectiveBottom = sectionTop + minRange;
            // But don't overlap with next section too much
            if (index < headingsArray.length - 1) {
              const nextSectionTop = headingsArray[index + 1].offsetTop;
              effectiveBottom = Math.min(effectiveBottom, nextSectionTop + 50);
            }
          }
          
          // Enhanced detection range with better tolerance
          const topOffset = -100; // Start detecting 100px before section
          const bottomOffset = -80; // Continue detecting 80px after section starts
          
          if (scrollPos >= sectionTop + topOffset && scrollPos < effectiveBottom + bottomOffset) {
            candidates.push({
              id: id,
              distance: Math.abs(scrollPos - sectionTop),
              top: sectionTop,
              element: heading,
              isSubsection: heading.tagName.toLowerCase() !== 'h2'
            });
          }
        });
        
        // Choose the best candidate based on priority and distance
        if (candidates.length > 0) {
          // Sort by distance, prioritizing closer sections
          candidates.sort((a, b) => {
            // Prefer subsections over main sections when close
            if (Math.abs(a.distance - b.distance) < 50) {
              if (a.isSubsection && !b.isSubsection) return -1;
              if (!a.isSubsection && b.isSubsection) return 1;
            }
            return a.distance - b.distance;
          });
          
          currentActiveSection = candidates[0].id;
        }
        
        // Determine main section for expansion
        const h2Headings = document.querySelectorAll('.article-content h2');
        h2Headings.forEach(function(heading) {
          const sectionTop = heading.offsetTop;
          const nextH2 = Array.from(h2Headings).find(h => h.offsetTop > sectionTop);
          const sectionBottom = nextH2 ? nextH2.offsetTop : document.body.scrollHeight;
          
          if (scrollPos >= sectionTop - 50 && scrollPos < sectionBottom - 50) {
            currentMainSection = heading.id;
          }
        });
        
        // Remove all active states
        catalogLinks.forEach(function(link) {
          link.classList.remove('active');
          const parentLi = link.closest('li');
          if (parentLi) {
            parentLi.classList.remove('active');
          }
        });
        
        // Set active state for current section (including sub-headings)
        if (currentActiveSection) {
          // Try to find exact match first
          let activeLink = document.querySelector('.catalog-list a[href="#' + currentActiveSection + '"]');
          
          // If no exact match, try to find a sub-heading that matches
          if (!activeLink) {
            const subHeadings = document.querySelectorAll('.sub-catalog a.sub-heading');
            subHeadings.forEach(function(subLink) {
              const href = subLink.getAttribute('href');
              if (href === '#' + currentActiveSection) {
                activeLink = subLink;
              }
            });
          }
          
          if (activeLink) {
            activeLink.classList.add('active');
          }
        }
        
        // Keep main section expanded if we're anywhere within it
        if (currentMainSection) {
          const mainSectionLink = document.querySelector('.catalog-list > li > a[href="#' + currentMainSection + '"]');
          if (mainSectionLink) {
            const parentLi = mainSectionLink.closest('li');
            if (parentLi) {
              parentLi.classList.add('active');
            }
          }
        }
      }
      
      window.addEventListener('scroll', updateActiveSection);
      updateActiveSection();
    });
  </script>
</body>
</html>